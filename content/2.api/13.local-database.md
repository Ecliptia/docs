---
title: Local Database
description: A built-in, file-based persistence layer for Moonlink.js. It stores data in JSON format with Write-Ahead Logging (WAL) for durability.
icon: lucide:hard-drive
---

The `Local` database provider offers persistent storage by saving data to the local file system. It is robust, featuring a Write-Ahead Log (WAL) to prevent data loss and periodic compaction to keep file sizes manageable. This is the default provider if `database.type` is set to `'local'`.

## Properties

::api-properties{name="Local Database Properties" description="Internal state of the local storage engine."}
::api-section{title="Paths"}
::
::api-schema{name="dir" type="string"}
The directory where data files are stored. Defaults to `../datastore`.
::
::api-schema{name="snapshotPath" type="string"}
Path to the main `.json` data file.
::
::api-schema{name="logPath" type="string"}
Path to the `.wal` write-ahead log file.
::

::api-section{title="Configuration"}
::
::api-schema{name="compactionIntervalMs" type="number"}
Interval for compacting the WAL into the snapshot (default: 60000ms).
::
::api-schema{name="walFlushIntervalMs" type="number"}
Interval for flushing the WAL buffer to disk (default: 500ms).
::
::

## Methods

### init(manager, options)
::api-card{name="init(manager, options)" method="init" returns="Promise<void>" anchorId="init"}
#description
Initializes the local storage. Creates the data directory if it doesn't exist, loads the snapshot, replays the WAL, and starts background maintenance tasks (compaction, flushing).

#default
::api-schema{name="manager" type="Manager" required}
The Moonlink Manager instance.
::
::api-schema{name="options" type="object"}
Optional configuration (e.g., path).
::

#example
```ts
// Called automatically by DatabaseManager
await localDb.init(manager);
```
::

### set(key, value)
::api-card{name="set(key, value)" method="set" returns="Promise<void>" anchorId="set"}
#description
Stores a value. Supports dot-notation for nested keys (e.g., `players.123.volume`). Writes the operation to the WAL buffer.

#default
::api-schema{name="key" type="string" required}
The key to store.
::
::api-schema{name="value" type="any" required}
The value to store.
::

#example
```ts
await localDb.set("user.settings.theme", "dark");
```
::

### get(key)
::api-card{name="get(key)" method="get" returns="Promise<T | undefined>" anchorId="get"}
#description
Retrieves a value from the in-memory store. Supports dot-notation.

#default
::api-schema{name="key" type="string" required}
The key to retrieve.
::

#example
```ts
const theme = await localDb.get("user.settings.theme");
```
::

### remove(key)
::api-card{name="remove(key)" method="remove" returns="Promise<boolean>" anchorId="remove"}
#description
Deletes a key from the store. Supports dot-notation. Logs the deletion to the WAL.

#default
::api-schema{name="key" type="string" required}
The key to remove.
::

#example
```ts
await localDb.remove("user.settings");
```
::

### has(key)
::api-card{name="has(key)" method="has" returns="Promise<boolean>" anchorId="has"}
#description
Checks if a key exists in the store.

#default
::api-schema{name="key" type="string" required}
The key to check.
::

#example
```ts
if (await localDb.has("session.id")) { ... }
```
::

### keys(pattern)
::api-card{name="keys(pattern)" method="keys" returns="Promise<string[]>" anchorId="keys"}
#description
Returns all keys in the store flattened (dot-notation). Supports a simple regex-like pattern matching.

#default
::api-schema{name="pattern" type="string"}
Optional pattern (e.g., `players.*`).
::

#example
```ts
const allPlayers = await localDb.keys("players.*");
```
::

### clear()
::api-card{name="clear()" method="clear" returns="Promise<void>" anchorId="clear"}
#description
Clears the entire database, resets the in-memory store, and empties the WAL file.

#example
```ts
await localDb.clear();
```
::

### shutdown()
::api-card{name="shutdown()" method="shutdown" returns="Promise<void>" anchorId="shutdown"}
#description
Gracefully shuts down the database. Performs a final compaction, flushes buffers, and closes file streams.

#example
```ts
await localDb.shutdown();
```
::