---
title: Manager
description: The Manager is the central hub of Moonlink.js. It coordinates nodes, audio players, and the connection with Discord.
icon: lucide:server-cog
---

The `Manager` class coordinates the connection between the Discord client, Lavalink nodes, and the database.

## Constructor

### new Manager(config)
::api-card{name="new Manager(config)"}
#description
Creates the central hub for Moonlink.js.

#default
::api-schema{name="config" type="IManagerConfig" required}
The main configuration object.
::

::api-section{title="IManagerConfig"}
::

::api-schema{name="nodes" type="INodeOptions[]" required nested}
An array of Lavalink nodes to connect to.
::
::api-schema{name="options" type="IManagerOptionsConfig" nested typeLink="#imanageroptionsconfig"}
Global settings for the manager, players, and system behavior.
::
::api-schema{name="send" type="(guildId, payload) => void" nested}
Optional. A function to send packets to Discord. Required if you do not use a Connector.
::

#example
```ts
const { Manager } = require('moonlink.js');

const manager = new Manager({
    nodes: [
        { host: 'localhost', port: 2333, password: 'youshallnotpass' }
    ],
    options: {
        clientName: 'MyMusicBot/1.0.0',
        reconnectAttempts: 3
    },
    // Required if not using manager.use()
    send: (id, payload) => client.guilds.cache.get(id)?.shard.send(payload)
});
```
::

## Properties

::api-properties{name="Manager Properties" description="Core components and state accessible via the Manager instance."}
::api-section{title="Sub-Managers"}
::
::api-schema{name="players" type="PlayerManager" typeLink="/api/player-manager"}
The interface for managing voice connections (create, destroy, get).
::
::api-schema{name="nodes" type="NodeManager" typeLink="/api/node-manager"}
The interface for managing Lavalink node connections and stats.
::
::api-schema{name="database" type="DatabaseManager" typeLink="/api/database-manager"}
The internal database for queue persistence.
::

::api-section{title="State & Config"}
::
::api-schema{name="options" type="IManagerOptionsConfig" typeLink="#imanageroptionsconfig"}
The readonly configuration object with defaults applied.
::
::api-schema{name="readyNodes" type="Map<string, Node>"}
A map of nodes that are connected and ready for requests.
::
::api-schema{name="initialized" type="boolean"}
Whether `init()` has been completed.
::
::api-schema{name="clientId" type="string"}
The Bot ID used for this session.
::
::

## Methods

### init(clientId)
::api-card{name="init(clientId)" method="init" returns="Promise<this>" anchorId="init"}
#description
Initializes the manager, connects to the database, and establishes connections to nodes.

#default
::api-schema{name="clientId" type="string" required}
The Discord Client ID.
::

#example
```ts
client.on('ready', async () => {
    // Initialize Moonlink when Discord is ready
    await manager.init(client.user.id);
    console.log('Moonlink Manager initialized!');
});
```
::

### use(connector, client)
::api-card{name="use(connector, client)" method="use" returns="this" anchorId="use"}
#description
Injects a Connector to bridge Moonlink.js with your Discord library.

#default
::api-schema{name="connector" type="Connector" required}
The connector instance.
::

::api-schema{name="client" type="any" required}
The client instance of your Discord library.
::

#example
```ts
const { Connectors } = require('moonlink.js');

// Using the built-in Discord.js connector
// This automates manager.init() and packet handling!
manager.use(new Connectors.DiscordJs(), client);
```
::

### search(options)
::api-card{name="search(options)" method="search" returns="Promise<SearchResult>" anchorId="search"}
#description
Searches for tracks, playlists, or albums.

#default
::api-schema{name="options" type="ISearchQuery" required}
The search configuration object.
::

::api-section{title="ISearchQuery"}
::

::api-schema{name="query" type="string" required nested}
The search term or URL.
::
::api-schema{name="source" type="string" nested}
Force a specific source.
::
::api-schema{name="requester" type="unknown" nested}
The requester of the track.
::
::api-schema{name="node" type="string" nested}
Optional node ID.
::

#example
```ts
const res = await manager.search({
    query: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
    requester: message.author
});

if (res.loadType === 'track') {
    // Add the first track to the player's queue
    player.queue.add(res.tracks[0]);
}
```
::

### packetUpdate(packet)
::api-card{name="packetUpdate(packet)" method="packetUpdate" returns="Promise<void>" anchorId="packetupdate"}
#description
Handles raw voice updates from Discord.

#default
::api-schema{name="packet" type="any" required}
The raw data packet.
::

#example
```ts
// Only necessary if NOT using a Connector
client.on('raw', (packet) => {
    manager.packetUpdate(packet);
});
```
::

### decodeTrack(encoded)
::api-card{name="decodeTrack(encoded)" method="decodeTrack" returns="ITrack" anchorId="decodetrack"}
#description
Decodes a Lavalink base64 track string.

#default
::api-schema{name="encoded" type="string" required}
The base64 string.
::

#example
```ts
const track = manager.decodeTrack("QAA...");
console.log(track.info.title);
```
::

### encodeTrack(track)
::api-card{name="encodeTrack(track)" method="encodeTrack" returns="string" anchorId="encodetrack"}
#description
Encodes a track object into a Lavalink base64 string.

#default
::api-schema{name="track" type="ITrackInfo" required}
The track information object.
::

#example
```ts
const base64 = manager.encodeTrack({
    title: "Rick Roll",
    author: "Rick Astley",
    identifier: "dQw4w9WgXcQ",
    length: 212000,
    isSeekable: true,
    isStream: false,
    uri: "https://youtube.com/watch?v=dQw4w9WgXcQ",
    sourceName: "youtube",
    position: 0
});
```
::

## Events

::api-card{name="Event Usage"}
#description
You can listen to any of these events using `manager.on(eventName, listener)`.

#example
```ts
manager.on("nodeCreate", (node) => {
    console.log(`Node created: ${node.identifier}`);
});

manager.on("trackStart", (player, track) => {
    console.log(`Now playing: ${track.title} in ${player.guildId}`);
});

manager.on("socketClosed", (player, code, reason) => {
    console.warn(`Voice socket closed: ${code} - ${reason}`);
});
```
::

::api-properties{name="Manager Events" description="Events emitted by the Manager instance during its lifecycle."}
::api-section{title="Debug"}
::
::api-schema{name="debug" type="(message: string) => void"}
Emitted for general debugging logs.
::

::api-section{title="Node Events"}
::
::api-schema{name="nodeCreate" type="(node: Node) => void"}
Emitted when a node is created.
::
::api-schema{name="nodeReady" type="(node: Node, payload: any) => void"}
Emitted when a node is ready.
::
::api-schema{name="nodeConnected" type="(node: Node) => void"}
Emitted when a node connects.
::
::api-schema{name="nodeReconnect" type="(node: Node) => void"}
Emitted when a node successfully reconnects.
::
::api-schema{name="nodeReconnecting" type="(node: Node, attempt: number) => void"}
Emitted when a node attempts to reconnect.
::
::api-schema{name="nodeResume" type="(node: Node) => void"}
Emitted when a node session is resumed.
::
::api-schema{name="nodeDisconnect" type="(node: Node, code: number, reason: string) => void"}
Emitted when a node disconnects.
::
::api-schema{name="nodeError" type="(node: Node, error: Error) => void"}
Emitted when a node has an error.
::
::api-schema{name="nodeDestroy" type="(identifier: string) => void"}
Emitted when a node is destroyed.
::
::api-schema{name="nodeRaw" type="(node: Node, payload: any) => void"}
Emitted when a raw packet is received from a node.
::
::api-schema{name="nodeStateChange" type="(node: Node, oldState: NodeState, newState: NodeState) => void"}
Emitted when a node's connection state changes.
::

::api-section{title="Player Events"}
::
::api-schema{name="playerCreate" type="(player: Player) => void"}
Emitted when a player is created.
::
::api-schema{name="playerDestroy" type="(player: Player, reason?: string) => void"}
Emitted when a player is destroyed.
::
::api-schema{name="playerUpdate" type="(player: Player, track: Track, payload: any) => void"}
Emitted when player update data is received.
::
::api-schema{name="playerSwitchedNode" type="(player: Player, oldNode: Node, newNode: Node) => void"}
Emitted when a player is transferred to a different node.
::
::api-schema{name="playerConnecting" type="(player: Player) => void"}
Emitted when a player starts connecting to voice.
::
::api-schema{name="playerConnected" type="(player: Player) => void"}
Emitted when a player successfully connects to voice.
::
::api-schema{name="playerReady" type="(player: Player) => void"}
Emitted when a player is fully ready.
::
::api-schema{name="playerResuming" type="(player: Player) => void"}
Emitted when a player starts resuming.
::
::api-schema{name="playerResumed" type="(player: Player) => void"}
Emitted when a player has successfully resumed.
::
::api-schema{name="playerDisconnected" type="(player: Player) => void"}
Emitted when a player disconnects from voice.
::
::api-schema{name="playerReconnect" type="(player: Player, reason?: string) => void"}
Emitted when a player attempts to reconnect.
::
::api-schema{name="playerMoved" type="(player: Player, oldChannel: string, newChannel: string) => void"}
Emitted when a player moves to a different voice channel.
::
::api-schema{name="playerMuteChange" type="(player: Player, selfMute: boolean, serverMute: boolean) => void"}
Emitted when a player's mute state changes.
::
::api-schema{name="playerDeafChange" type="(player: Player, selfDeaf: boolean, serverDeaf: boolean) => void"}
Emitted when a player's deaf state changes.
::
::api-schema{name="playerSuppressChange" type="(player: Player, suppress: boolean) => void"}
Emitted when a player's suppression state changes.
::
::api-schema{name="playerAutoPlaySet" type="(player: Player, autoPlay: boolean) => void"}
Emitted when autoPlay is toggled.
::
::api-schema{name="playerAutoLeaveSet" type="(player: Player, autoLeave: boolean) => void"}
Emitted when autoLeave is toggled.
::
::api-schema{name="playerChangedVolume" type="(player: Player, oldVolume: number, volume: number) => void"}
Emitted when the volume is changed.
::
::api-schema{name="playerChangedLoop" type="(player: Player, oldLoop: PlayerLoop, loop: PlayerLoop) => void"}
Emitted when the loop mode is changed.
::
::api-schema{name="playerTextChannelIdSet" type="(player: Player, oldChannel: string, newChannel: string) => void"}
Emitted when the text channel is updated.
::
::api-schema{name="playerVoiceChannelIdSet" type="(player: Player, oldChannel: string, newChannel: string) => void"}
Emitted when the voice channel ID is updated manually.
::
::api-schema{name="playerNodeSet" type="(player: Player, oldNode: string, newNode: string) => void"}
Emitted when the player's node identifier is updated.
::
::api-schema{name="playerRecoveryStarted" type="(player: Player) => void"}
Emitted when player recovery begins.
::
::api-schema{name="playerRecoverySuccess" type="(player: Player) => void"}
Emitted when player recovery succeeds.
::
::api-schema{name="playerRecoveryFailed" type="(player: Player) => void"}
Emitted when player recovery fails.
::

::api-section{title="Failover Events"}
::
::api-schema{name="playersMoved" type="(players: Player[], oldNode: Node, newNode: Node) => void"}
Emitted when multiple players are moved due to node failure.
::
::api-schema{name="playersOrphaned" type="(players: Player[], deadNode: Node) => void"}
Emitted when players cannot be moved and are left without a node.
::

::api-section{title="Player Triggered Events"}
::
::api-schema{name="playerTriggeredPlay" type="(player: Player, track: Track) => void"}
Emitted when `play()` is called.
::
::api-schema{name="playerTriggeredPause" type="(player: Player) => void"}
Emitted when `pause()` is called.
::
::api-schema{name="playerTriggeredResume" type="(player: Player) => void"}
Emitted when `resume()` is called.
::
::api-schema{name="playerTriggeredStop" type="(player: Player) => void"}
Emitted when `stop()` is called.
::
::api-schema{name="playerTriggeredSkip" type="(player: Player, oldTrack: object, currentTrack: Track) => void"}
Emitted when `skip()` is called.
::
::api-schema{name="playerTriggeredSeek" type="(player: Player, position: number) => void"}
Emitted when `seek()` is called.
::
::api-schema{name="playerTriggeredShuffle" type="(player: Player, oldQueue: object, currentQueue: Track[]) => void"}
Emitted when `shuffle()` is called.
::
::api-schema{name="playerTriggeredBack" type="(player: Player, track: Track) => void"}
Emitted when `back()` is called.
::

::api-section{title="Track Events"}
::
::api-schema{name="trackStart" type="(player: Player, track: Track) => void"}
Emitted when a track starts playing.
::
::api-schema{name="trackEnd" type="(player: Player, track: Track, reason: TrackEndReason) => void"}
Emitted when a track finishes playing.
::
::api-schema{name="trackStuck" type="(player: Player, track: Track, threshold: number) => void"}
Emitted when a track gets stuck.
::
::api-schema{name="trackException" type="(player: Player, track: Track, exception: any) => void"}
Emitted when a track errors.
::

::api-section{title="Queue Events"}
::
::api-schema{name="queueAdd" type="(player: Player, tracks: Track | Track[]) => void"}
Emitted when tracks are added.
::
::api-schema{name="queueRemove" type="(player: Player, tracks: Track | Track[]) => void"}
Emitted when tracks are removed.
::
::api-schema{name="queueMoveRange" type="(player: Player, tracks: Track[], from: number, to: number) => void"}
Emitted when tracks are moved.
::
::api-schema{name="queueRemoveRange" type="(player: Player, tracks: Track[], start: number, end: number) => void"}
Emitted when a range of tracks is removed.
::
::api-schema{name="queueDuplicate" type="(player: Player, tracks: Track[], index: number) => void"}
Emitted when tracks are duplicated.
::
::api-schema{name="queueEnd" type="(player: Player) => void"}
Emitted when the queue is empty.
::

::api-section{title="Other Events"}
::
::api-schema{name="filtersUpdate" type="(player: Player, filters: Filters) => void"}
Emitted when filters are updated.
::
::api-schema{name="socketClosed" type="(player: Player, code: number, reason: string, remote: boolean) => void"}
Emitted when the voice connection closes.
::
::api-schema{name="voiceSessionChanged" type="(player: Player, oldId: string | boolean, newId: string) => void"}
Emitted when voice session ID changes.
::
::api-schema{name="autoPlayed" type="(player: Player, track: Track, prev: Track) => void"}
Emitted when a track plays via AutoPlay.
::
::api-schema{name="autoLeaved" type="(player: Player, lastTrack?: Track) => void"}
Emitted when the bot auto-leaves.
::
::