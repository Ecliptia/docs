---
title: WebSocket
description: A custom WebSocket implementation that unifies behavior across Node.js and Bun environments, featuring automatic heartbeats and latency tracking.
icon: lucide:arrow-left-right
---

The `WebSocket` class is an internal utility used by the `Node` class to communicate with Lavalink. It abstracts away the differences between Node.js native `http`/`https` requests and Bun's native `WebSocket` implementation.

::alert{type="info"}
**Extends:** `EventEmitter`
::

## Constructor

### new WebSocket(url, options)
::api-card{name="new WebSocket(url, options)"}
#description
Creates a new WebSocket connection.

#default
::api-schema{name="url" type="string" required}
The URL to connect to.
::
::api-schema{name="options" type="object"}
Connection options.
::

::api-section{title="options"}
::

::api-schema{name="headers" type="Record<string, string>" nested}
Custom headers to send with the handshake.
::
::

## Properties

::api-properties{name="WebSocket Properties" description="Connection state and metrics."}
::api-section{title="State"}
::
::api-schema{name="readyState" type="number"}
The current state of the connection (1 = Open, 3 = Closed).
::
::api-schema{name="latency" type="number"}
The current round-trip latency in milliseconds.
::
::

## Events

::api-properties{name="WebSocket Events" description="Events emitted by the socket during its lifecycle."}
::api-section{title="Lifecycle"}
::
::api-schema{name="open" type="void"}
Emitted when the connection is established.
::
::api-schema{name="close" type="{ code: number, reason: string }"}
Emitted when the connection is closed.
::
::api-schema{name="error" type="{ error: Error }"}
Emitted when an error occurs.
::

::api-section{title="Data & Debug"}
::
::api-schema{name="message" type="{ data: string | Buffer }"}
Emitted when a message is received.
::
::api-schema{name="ping" type="Buffer"}
Emitted when a ping frame is received.
::
::api-schema{name="pong" type="number | void"}
Emitted when a pong frame is received.
::
::api-schema{name="debug" type="string"}
Emitted for debug logs (Node.js only).
::
::

## Methods

### send(data)
::api-card{name="send(data)" method="send" returns="void" anchorId="send"}
#description
Sends data to the WebSocket server.

#default
::api-schema{name="data" type="string | Buffer" required}
The data to send.
::

#example
```ts
ws.send(JSON.stringify({ op: "ping" }));
```
::

### close(code, reason)
::api-card{name="close(code, reason)" method="close" returns="void" anchorId="close"}
#description
Closes the WebSocket connection.

#default
::api-schema{name="code" type="number"}
Status code (default: 1000).
::
::api-schema{name="reason" type="string"}
Reason for closing.
::

#example
```ts
ws.close(1000, "Normal closure");
```
::

### ping(data)
::api-card{name="ping(data)" method="ping" returns="Promise<number>" anchorId="ping"}
#description
Sends a ping frame and waits for a pong. Returns the latency in milliseconds.
**Note:** Not supported in Bun environments.

#default
::api-schema{name="data" type="string | Buffer"}
Optional payload for the ping.
::

#example
```ts
const latency = await ws.ping();
console.log(`Latency: ${latency}ms`);
```
::

### on(event, listener)
::api-card{name="on(event, listener)" method="on" returns="this" anchorId="on"}
#description
Adds a listener for the specified event. Inherited from `EventEmitter`.

#default
::api-schema{name="event" type="string" required}
The event name.
::
::api-schema{name="listener" type="Function" required}
The callback function.
::

#example
```ts
ws.on("message", (msg) => console.log(msg));
```
::

### once(event, listener)
::api-card{name="once(event, listener)" method="once" returns="this" anchorId="once"}
#description
Adds a one-time listener for the specified event. Inherited from `EventEmitter`.

#default
::api-schema{name="event" type="string" required}
The event name.
::
::api-schema{name="listener" type="Function" required}
The callback function.
::

#example
```ts
ws.once("open", () => console.log("Connected!"));
```
::

### off(event, listener)
::api-card{name="off(event, listener)" method="off" returns="this" anchorId="off"}
#description
Removes a listener for the specified event. Inherited from `EventEmitter`.

#default
::api-schema{name="event" type="string" required}
The event name.
::
::api-schema{name="listener" type="Function" required}
The callback function to remove.
::
::

### emit(event, ...args)
::api-card{name="emit(event, ...args)" method="emit" returns="boolean" anchorId="emit"}
#description
Synchronously calls each of the listeners registered for the event. Inherited from `EventEmitter`.

#default
::api-schema{name="event" type="string" required}
The event name.
::
::api-schema{name="...args" type="any[]"}
Arguments to pass to the listeners.
::
::