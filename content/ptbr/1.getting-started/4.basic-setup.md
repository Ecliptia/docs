---
title: Configuração Básica
description: "Configure o Moonlink.js com seu bot do Discord para reprodução de música"
icon: 'lucide:settings'
authors:
  - avatar: https://www.npmjs.com/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9hNmE5NDVhYjJiNzk1MjcyNzVjN2IwMWEyNWM1YzQ2NT9zaXplPTQ5NiZkZWZhdWx0PXJldHJvIn0.5hP6oyShhR-UWUi6KF-lA0cWmE_BJjvIFAwkYCGEZNo
    name: Lucas Morais Rodrigues
    username: 1Lucas1apk
    to: https://github.com/1Lucas1apk
    target: _blank
---

::alert{type="info" icon="lucide:settings"}
Este guia mostra como integrar o Moonlink.js em seu bot do Discord. Ele cobre a criação da instância do Manager, sua inicialização, o tratamento de atualizações de estado de voz e o tratamento básico de eventos.
::

## Pré-requisitos

Antes de prosseguir, certifique-se de que você possui:

- **Moonlink.js** e suas dependências instaladas.
- Uma instância do **Lavalink** em execução (consulte a [Documentação do Lavalink](https://lavalink.dev/)).
- Um bot do Discord configurado com as intents necessárias ativadas.

---

## 1. Criando a Instância do Manager

O Moonlink.js usa um `Manager` para lidar com conexões com o Lavalink, criar players e gerenciar eventos. Crie uma nova instância fornecendo a configuração do seu node Lavalink e uma função para encaminhar as atualizações de estado de voz.

### Exemplo (JavaScript)

```js
const { Client, GatewayIntentBits } = require('discord.js');
const { Manager } = require('moonlink.js');

// Inicialize o cliente do Discord com as intents necessárias
const client = new Client({
  intents: [
    GatewayIntentBits.Guilds,
    GatewayIntentBits.GuildVoiceStates,
    GatewayIntentBits.GuildMessages,
    GatewayIntentBits.MessageContent,
  ],
});

// Crie o Manager do Moonlink
const manager = new Manager({
  nodes: [
    {
      host: 'localhost',    // Host do Lavalink
      port: 2333,           // Porta do Lavalink
      password: 'youshallnotpass', // Senha do Lavalink
      secure: false,
    },
  ],
  sendPayload: (guildId, payload) => {
    const guild = client.guilds.cache.get(guildId);
    if (guild) guild.shard.send(JSON.parse(payload));
  },
});

// Anexe o manager ao seu cliente para fácil acesso
client.manager = manager;
```

### Exemplo (TypeScript)

```ts
import { Client, GatewayIntentBits } from 'discord.js';
import { Manager } from 'moonlink.js';

// Inicialize o cliente do Discord com as intents necessárias
const client = new Client({
  intents: [
    GatewayIntentBits.Guilds,
    GatewayIntentBits.GuildVoiceStates,
    GatewayIntentBits.GuildMessages,
    GatewayIntentBits.MessageContent,
  ],
});

// Crie o Manager do Moonlink
const manager = new Manager({
  nodes: [
    {
      host: 'localhost',
      port: 2333,
      password: 'youshallnotpass',
      secure: false,
    },
  ],
  sendPayload: (guildId: string, payload: string) => {
    const guild = client.guilds.cache.get(guildId);
    if (guild) guild.shard.send(JSON.parse(payload));
  },
});

// Anexe o manager ao cliente
(client as any).manager = manager;
```

---

## 2. Inicializando o Manager

Quando seu bot estiver pronto, inicialize o Manager para se conectar aos seus nodes Lavalink. Esta etapa deve ocorrer assim que seu cliente estiver logado.

```js
client.once('ready', () => {
  console.log(`Logado como ${client.user.tag}`);
  client.manager.init(client.user.id);
});
```

---

## 3. Tratando Atualizações de Estado de Voz

Para que o Moonlink.js funcione corretamente com o sistema de voz do Discord, encaminhe todos os pacotes brutos de estado de voz:

```js
client.on('raw', (packet) => {
  client.manager.packetUpdate(packet);
});
```

---

## 4. Tratamento Básico de Eventos

O Moonlink.js emite vários eventos para o status do node e do player. Veja como ouvir alguns eventos comuns:

```js
// Eventos do Node
client.manager.on('nodeConnect', (node) => {
  console.log(`Node ${node.identifier} conectado!`);
});

client.manager.on('nodeDisconnect', (node) => {
  console.log(`Node ${node.identifier} desconectado!`);
});

client.manager.on('nodeError', (node, error) => {
  console.error(`Node ${node.identifier} encontrou um erro:`, error);
});

// Eventos do Player
client.manager.on('trackStart', (player, track) => {
  const channel = client.channels.cache.get(player.textChannelId);
  if (channel) channel.send(`Tocando agora: **${track.title}**`);
});

client.manager.on('queueEnd', (player) => {
  const channel = client.channels.cache.get(player.textChannelId);
  if (channel) channel.send('A fila terminou!');
  
  // Opcionalmente, desconecte após um atraso
  setTimeout(() => {
    if (!player.playing && player.queue.size === 0) {
      player.destroy();
      if (channel) channel.send('Desconectado por inatividade.');
    }
  }, 30000); // 30 segundos
});
```

---

## 5. Exemplo Completo

Abaixo está um exemplo consolidado que reúne todas as peças para uma configuração básica de um bot de música usando Moonlink.js.

```js
const { Client, GatewayIntentBits } = require('discord.js');
const { Manager } = require('moonlink.js');

// Inicialize o cliente do Discord
const client = new Client({
  intents: [
    GatewayIntentBits.Guilds,
    GatewayIntentBits.GuildVoiceStates,
    GatewayIntentBits.GuildMessages,
    GatewayIntentBits.MessageContent,
  ],
});

// Crie o Manager do Moonlink com as configurações do seu node Lavalink
client.manager = new Manager({
  nodes: [
    {
      host: 'localhost',
      port: 2333,
      password: 'youshallnotpass',
      secure: false,
      identifier: 'Node Principal',
    },
  ],
  sendPayload: (guildId, payload) => {
    const guild = client.guilds.cache.get(guildId);
    if (guild) guild.shard.send(JSON.parse(payload));
  },
  defaultVolume: 100,
  autoPlay: true,
});

// Inicialize o manager quando o cliente estiver pronto
client.once('ready', () => {
  console.log(`Logado como ${client.user.tag}`);
  client.manager.init(client.user.id);
});

// Encaminhe pacotes brutos para atualizações de voz
client.on('raw', (packet) => {
  client.manager.packetUpdate(packet);
});

// Lide com eventos do node
client.manager.on('nodeConnect', (node) => console.log(`Node ${node.identifier} conectado!`));
client.manager.on('nodeError', (node, error) => console.error(`Node ${node.identifier} erro:`, error));

// Exemplo de comando para tocar uma faixa (implementação básica)
client.on('messageCreate', async (message) => {
  if (message.author.bot || !message.guild) return;

  if (message.content.startsWith('!play')) {
    const voiceChannel = message.member.voice.channel;
    if (!voiceChannel) return message.reply('Você precisa estar em um canal de voz!');

    const query = message.content.replace('!play', '').trim();
    if (!query) return message.reply('Por favor, especifique uma música para tocar.');

    const player = client.manager.createPlayer({
      guildId: message.guild.id,
      voiceChannelId: voiceChannel.id,
      textChannelId: message.channel.id,
      autoPlay: true,
    });
    
    player.connect();
    
    const result = await client.manager.search({
      query
    });
    if (!result.tracks.length) return message.reply('Nenhum resultado encontrado!');
    
    player.queue.add(result.tracks[0]);
    if (!player.playing) player.play();

    message.reply(`Adicionado à fila: **${result.tracks[0].title}**`);
  }
});

// Faça login no Discord
client.login('SEU_TOKEN_DO_BOT');
```