---
title: Listen
description: "API reference for the Listen class in Moonlink.js"
icon: 'lucide:mic'
authors:
  - avatar: https://www.npmjs.com/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9hNmE5NDVhYjJiNzk1MjcyNzVjN2IwMWEyNWM1YzQ2NT9zaXplPTQ5NiZkZWZhdWx0PXJldHJvIn0.5hP6oyShhR-UWUi6KF-lA0cWmE_BJjvIFAwkYCGEZNo
    name: Lucas Morais Rodrigues
    username: 1Lucas1apk
    to: https://github.com/1Lucas1apk
    target: _blank
---

<branch version="1.0.x">

::card{icon="lucide:mic"}
#title
Listen Class

#description
The Listen class allows you to receive voice events from users in a voice channel. It is used to create features like voice detection, speech transcription, and other interactive voice-based features.
<br>
```js
player.listen
```
::

::alert{type="info" icon="lucide:info"}
The Listen functionality requires a compatible NodeLink server. It does not work with standard Lavalink servers.
::

## Overview

::card{icon="lucide:box"}
#title
Properties

#description
Core properties of the Listen class.
<br>
<h5>Available Properties</h5>

#content
| Property | Type | Description |
|----------|------|-------------|
| `player` | `Player` | Reference to the Player instance |
| `voiceReceiverWs` | `WebSocket` | WebSocket connection to the NodeLink server |
::

## Methods

::card{icon="lucide:code"}
#title
Methods

#description
Available methods in the Listen class.
<br>
<h5>Available Methods</h5>

#content
#### start
::field{name="start" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:play'
  ---
  #title
  Start Voice Reception

  #description
  Starts receiving voice events for the current player. Throws an error if the connected node is not a NodeLink.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Returns & Example

  #description
  **Returns**
  • **`EventEmitter`** — Event emitter that emits voice-related events

  **Emitted Events**
  | Event | Description | Data |
  |-------|-------------|------|
  | `start` | Emitted when a user starts speaking. | `{ userId: string, guildId: string, ssrc: number, audio: boolean, video: boolean, rtx: boolean }` |
  | `end` | Emitted when a user stops speaking. | `{ userId: string, guildId: string, ssrc: number, data: Buffer }` (audio data in Buffer format) |
  | `close` | Emitted when the WebSocket connection is closed. | `void` |
  | `error` | Emitted when an error occurs. | `Error` object |
  | `unknown` | Emitted when an unknown event is received. | `any` (full payload) |

```js
// Start voice reception
const listener = player.listen.start();

// Listen for voice events
listener.on('start', (data) => {
  console.log(`User ${data.userId} started speaking`);
});

listener.on('end', (data) => {
  console.log(`User ${data.userId} stopped speaking`);
  console.log('Audio data received:', data.data); // Buffer containing audio data
});
```
  ::
::
::

#### stop
::field{name="stop" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:square'
  ---
  #title
  Stop Voice Reception

  #description
  Stops receiving voice events for the current player.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Returns & Example

  #description
  **Returns**
  • **`boolean`** — `true` if reception was successfully stopped, `undefined` if there was no active reception

```js
// Stop voice reception
const stopped = player.listen.stop();
console.log('Reception stopped:', stopped);
```
  ::
::
::
::

## Usage Examples

::card{icon="lucide:code"}
#title
Basic Examples

#description
Practical examples of how to use the Listen class.

#content
### Voice Activity Detector

```js
// Create a map to track who is speaking
const speakingUsers = new Map();

// Start receiving voice events
const listener = player.listen.start();

// Listen for when a user starts speaking
listener.on('start', (data) => {
  speakingUsers.set(data.userId, Date.now());
  console.log(`User ${data.userId} started speaking`);
});

// Listen for when a user stops speaking
listener.on('end', (data) => {
  const startTime = speakingUsers.get(data.userId);
  if (startTime) {
    const duration = Date.now() - startTime;
    speakingUsers.delete(data.userId);
    console.log(`User ${data.userId} spoke for ${duration}ms`);
  }
});

// Stop reception when the player is destroyed
player.on('destroy', () => {
  player.listen.stop();
  speakingUsers.clear();
});
```

### Saving User Audio

```js
const fs = require('fs');
const path = require('path');

// Create directory to save audio if it doesn't exist
const audioDir = path.join(__dirname, 'user_audio');
if (!fs.existsSync(audioDir)) {
  fs.mkdirSync(audioDir);
}

// Start receiving voice events
const listener = player.listen.start();

// Listen for when a user stops speaking
listener.on('end', (data) => {
  // Create filename based on user ID and timestamp
  const fileName = path.join(audioDir, `${data.userId}_${Date.now()}.pcm`);
  
  // Save the audio data to a file
  fs.writeFileSync(fileName, data.data);
  console.log(`Audio saved to ${fileName}`);
});
```
::

::button-link{right-icon="lucide:arrow-right" to="/api/player-manager"}
  Continue to PlayerManager
:: 