---
title: Listen
description: "Referência da API para a classe Listen em Moonlink.js"
icon: 'lucide:mic'
authors:
  - avatar: https://www.npmjs.com/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF2YXRhci5jb20vYXZhdGFyL2E2YTk0NWFhYjJiNzk1MjcyNzVjN2IwMWEyNWM1YzQ2NT9zaXplPTQ5NiZkZWZhdWx0PXJldHJvIn0.5hP6oyShhR-UWUi6KF-lA0cWmE_BJjvIFAwkYCGEZNo
    name: Lucas Morais Rodrigues
    username: 1Lucas1apk
    to: https://github.com/1Lucas1apk
    target: _blank
---

<branch version="1.0.x">

::card{icon="lucide:mic"}
#title
Classe Listen

#description
A classe Listen permite receber eventos de voz de usuários em um canal de voz. É usada para criar recursos como detecção de voz, transcrição de fala e outros recursos interativos baseados em voz.
<br>
```js
player.listen
```
::

::alert{type="info" icon="lucide:info"}
A funcionalidade Listen requer um servidor NodeLink compatível. Não funciona com servidores Lavalink padrão.
::

## Visão Geral

::card{icon="lucide:box"}
#title
Propriedades

#description
Propriedades principais da classe Listen.
<br>
<h5>Propriedades Disponíveis</h5>

#content
| Propriedade | Tipo | Descrição |
|----------|------|-------------|
| `player` | `Player` | Referência à instância do Player |
| `voiceReceiverWs` | `WebSocket` | Conexão WebSocket com o servidor NodeLink |
::

## Métodos

::card{icon="lucide:code"}
#title
Métodos

#description
Métodos disponíveis na classe Listen.
<br>
<h5>Métodos Disponíveis</h5>

#content
#### start
::field{name="start" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:play'
  ---
  #title
  Iniciar Recepção de Voz

  #description
  Começa a receber eventos de voz para o player atual. Lança um erro se o node conectado não for um NodeLink.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`EventEmitter`** — Emissor de eventos que emite eventos relacionados à voz

  **Eventos Emitidos**
  | Evento | Descrição | Dados |
  |-------|-------------|------|
  | `start` | Emitido quando um usuário começa a falar. | `{ userId: string, guildId: string, ssrc: number, audio: boolean, video: boolean, rtx: boolean }` |
  | `end` | Emitido quando um usuário para de falar. | `{ userId: string, guildId: string, ssrc: number, data: Buffer }` (dados de áudio em formato Buffer) |
  | `close` | Emitido quando a conexão WebSocket é fechada. | `void` |
  | `error` | Emitido quando ocorre um erro. | Objeto `Error` |
  | `unknown` | Emitido quando um evento desconhecido é recebido. | `any` (payload completo) |

```js
// Iniciar recepção de voz
const listener = player.listen.start();

// Ouvir eventos de voz
listener.on('start', (data) => {
  console.log(`Usuário ${data.userId} começou a falar`);
});

listener.on('end', (data) => {
  console.log(`Usuário ${data.userId} parou de falar`);
  console.log('Dados de áudio recebidos:', data.data); // Buffer contendo dados de áudio
});
```
  ::
::
::

#### stop
::field{name="stop" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:square'
  ---
  #title
  Parar Recepção de Voz

  #description
  Para de receber eventos de voz para o player atual.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`boolean`** — `true` se a recepção foi parada com sucesso, `undefined` se não havia recepção ativa

```js
// Parar recepção de voz
const stopped = player.listen.stop();
console.log('Recepção parada:', stopped);
```
  ::
::
::
::

## Exemplos de Uso

::card{icon="lucide:code"}
#title
Exemplos Básicos

#description
Exemplos práticos de como usar a classe Listen.

#content
### Detector de Atividade de Voz

```js
// Crie um mapa para rastrear quem está falando
const speakingUsers = new Map();

// Comece a receber eventos de voz
const listener = player.listen.start();

// Ouça quando um usuário começa a falar
listener.on('start', (data) => {
  speakingUsers.set(data.userId, Date.now());
  console.log(`Usuário ${data.userId} começou a falar`);
});

// Ouça quando um usuário para de falar
listener.on('end', (data) => {
  const startTime = speakingUsers.get(data.userId);
  if (startTime) {
    const duration = Date.now() - startTime;
    speakingUsers.delete(data.userId);
    console.log(`Usuário ${data.userId} falou por ${duration}ms`);
  }
});

// Pare a recepção quando o player for destruído
player.on('destroy', () => {
  player.listen.stop();
  speakingUsers.clear();
});
```

### Salvando Áudio do Usuário

```js
const fs = require('fs');
const path = require('path');

// Crie o diretório para salvar o áudio se ele não existir
const audioDir = path.join(__dirname, 'user_audio');
if (!fs.existsSync(audioDir)) {
  fs.mkdirSync(audioDir);
}

// Comece a receber eventos de voz
const listener = player.listen.start();

// Ouça quando um usuário para de falar
listener.on('end', (data) => {
  // Crie o nome do arquivo com base no ID do usuário e no timestamp
  const fileName = path.join(audioDir, `${data.userId}_${Date.now()}.pcm`);
  
  // Salve os dados de áudio em um arquivo
  fs.writeFileSync(fileName, data.data);
  console.log(`Áudio salvo em ${fileName}`);
});
```
::

::button-link{right-icon="lucide:arrow-right" to="/api/player-manager"}
  Continuar para PlayerManager
:: 