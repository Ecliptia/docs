---
title: Database
description: "Referência da API para a classe Database em Moonlink.js"
icon: 'lucide:database'
authors:
  - avatar: https://www.npmjs.com/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9hNmE5NDVhYjJiNzk1MjcyNzVjN2IwMWEyNWM1YzQ2NT9zaXplPTQ5NiZkZWZhdWx0PXJldHJvIn0.5hP6oyShhR-UWUi6KF-lA0cWmE_BJjvIFAwkYCGEZNo
    name: Lucas Morais Rodrigues
    username: 1Lucas1apk
    to: https://github.com/1Lucas1apk
    target: _blank
---

<branch version="1.0.x">

::card{icon="lucide:database"}
#title
Classe Database

#description
A classe Database fornece um sistema robusto de armazenamento chave-valor para o Moonlink.js, usado internamente para armazenar dados de players, nodes e filas. Ela utiliza um Write-Ahead Log (WAL) para persistência e recuperação de dados.
<br>

::alert{type="info" icon="lucide:info"}
A classe Database é inicializada automaticamente pelo Manager e pode ser acessada através de `manager.database`. Ela é instanciada usando o método estático `Database.create()`.
::

## Visão Geral

::card{icon="lucide:box"}
#title
Inicialização

#description
O Banco de Dados é inicializado assincronamente e deve ser acessado através do método estático `create`.
<br>

```typescript
class Database {
  static async create(manager: Manager): Promise<Database>;
}
```

#content
**Exemplo**
```js
const manager = new Manager({ /* ... */ });
// O Banco de Dados é criado automaticamente durante manager.init()
await manager.init(client.user.id);
const database = manager.database;
```
::

## Métodos

::card{icon="lucide:settings"}
#title
Métodos

#description
Métodos disponíveis na classe Database.
<br>
<h5>Métodos Disponíveis</h5>

#content
#### set
::field{name="set" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:edit'
  ---
  #title
  Definir Valor

  #description
  Armazena um valor associado a uma chave. Se a chave aponta para um objeto e o novo valor também é um objeto, eles serão mesclados. Suporta log opcional para WAL.
  <br>
  <h5>Parâmetros</h5>

  ::field-group
    ::field{name="key" type="string" required}
    A chave (caminho) para armazenar o valor (ex: `settings.volume`, `players.guildId.volume`)
    ::
    ::field{name="value" type="T" required}
    O valor a ser armazenado
    ::
    ::field{name="log" type="boolean"}
    Opcional: Se deve registrar esta operação no Write-Ahead Log. Padrão para `true`.
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`void`** - Lança erro se a propriedade for inválida

```js
database.set('settings.volume', 100);
database.set('queue.guildId', tracks, false); // Não registrar no WAL
```
  ::
::
::

#### get
::field{name="get" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:search'
  ---
  #title
  Obter Valor

  #description
  Recupera um valor pela sua chave.
  <br>
  <h5>Parâmetros</h5>

  ::field-group
    ::field{name="key" type="string" required}
    A chave (caminho) a ser recuperada
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`T | undefined`** - O valor armazenado ou indefinido se não encontrado

```js
const volume = database.get('settings.volume');
const queue = database.get('queue.guildId');
```
  ::
::
::

#### delete
::field{name="delete" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:trash'
  ---
  #title
  Excluir Valor

  #description
  Remove um valor pela sua chave. Suporta log opcional para WAL.
  <br>
  <h5>Parâmetros</h5>

  ::field-group
    ::field{name="key" type="string" required}
    A chave (caminho) a ser excluída
    ::
    ::field{name="log" type="boolean"}
    Opcional: Se deve registrar esta operação no Write-Ahead Log. Padrão para `true`.
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`boolean`** - Verdadeiro se a chave foi excluída, falso caso contrário

```js
const deleted = database.delete('settings.volume');
database.delete('queue.guildId', false); // Não registrar no WAL
```
  ::
::
::

#### keys
::field{name="keys" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:key'
  ---
  #title
  Obter Todas as Chaves

  #description
  Recupera todas as chaves de nível superior e aninhadas armazenadas no banco de dados.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`string[]`** - Um array de todas as chaves.

  ```js
  const allKeys = database.keys();
  console.log(allKeys);
  // Exemplo: ['players.guildId.volume', 'nodes.nodeId.sessionId']
  ```
  ::
::
::

#### clear
::field{name="clear" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:eraser'
  ---
  #title
  Limpar Todos os Dados

  #description
  Limpa todos os dados do banco de dados, efetivamente redefinindo-o. Também limpa o Write-Ahead Log.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`void`**

  ```js
  database.clear();
  console.log('Banco de dados limpo.');
  ```
  ::
::
::

#### shutdown
::field{name="shutdown" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:power-off'
  ---
  #title
  Desligar Banco de Dados

  #description
  Desliga o banco de dados de forma graciosa, garantindo que todas as gravações pendentes sejam descarregadas e os recursos sejam liberados.
  Isso deve ser chamado antes que sua aplicação seja encerrada.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`Promise<void>`**

  ```js
  await database.shutdown();
  console.log('Banco de dados desligado.');
  ```
  ::
::
::

## Armazenamento de Arquivos

::card{icon="lucide:hard-drive"}
#title
Persistência do Write-Ahead Log (WAL)

#description
A classe Database implementa um sistema Write-Ahead Log (WAL) para persistência e recuperação robusta de dados.

#content
As alterações de dados são primeiro gravadas em um arquivo de log sequencial (WAL) e depois periodicamente compactadas em um arquivo de snapshot. Isso garante a integridade dos dados e permite a recuperação em caso de desligamentos inesperados.

- **Arquivos de Log**: As alterações são anexadas a `data.{clientId}.wal`.
- **Arquivos de Snapshot**: Periodicamente, o estado em memória é salvo em `data.{clientId}.json`.
- **Recuperação Automática**: Na inicialização, o banco de dados reproduz o WAL para restaurar o estado mais recente.

**Estrutura de Arquivos**
```
moonlink.js/
  └── src/
      └── datastore/
          ├── data.123456789.json  // Snapshot do banco de dados
          └── data.123456789.wal   // Write-Ahead Log
```

::alert{type="warning" icon="lucide:alert-triangle"}
O sistema de armazenamento de arquivos é tratado automaticamente. Você não deve precisar interagir com esses arquivos diretamente. A modificação manual pode levar à corrupção de dados.
::
::

## Exemplos de Uso

::card{icon="lucide:code"}
#title
Uso Básico

#description
Exemplos de uso da classe Database.

#content
```js
// Acesse o banco de dados através do gerenciador
const database = manager.database;

// Armazene dados do player
database.set(`players.${guildId}`, {
  volume: 100,
  paused: false,
  position: 0
});

// Recupere dados do player
const playerData = database.get(`players.${guildId}`);

// Remova dados do player
database.delete(`players.${guildId}`);

// Obtenha todas as chaves
const allKeys = database.keys();

// Limpe todos os dados
database.clear();

// Desligue o banco de dados (chame antes que a aplicação seja encerrada)
await database.shutdown();
```
::

::button-link{right-icon="lucide:arrow-right" to="/api/listen"}
  Continuar para Listen
:: 