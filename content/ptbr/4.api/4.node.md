---
title: Node
description: "Referência da API para a classe Node em Moonlink.js"
icon: 'lucide:server'
authors:
  - avatar: https://www.npmjs.com/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9hNmE5NDVhYjJiNzk1MjcyNzVjN2IwMWEyNWM1YzQ2NT9zaXplPTQ5NiZkZWZhdWx0PXJldHJvIn0.5hP6oyShhR-UWUi6KF-lA0cWmE_BJjvIFAwkYCGEZNo
    name: Lucas Morais Rodrigues
    username: 1Lucas1apk
    to: https://github.com/1Lucas1apk
    target: _blank
---

A classe `Node` representa uma conexão com um servidor Lavalink. Ela gerencia a comunicação entre seu bot do Discord e o servidor Lavalink, permitindo a reprodução de áudio.

::alert{type="info" icon="lucide:info"}
Nodes são os pontos de conexão com os servidores Lavalink. Cada node lida com o processamento e a transmissão de áudio reais, enquanto seu bot gerencia a interface do player.
::

::card
---
icon: lucide:box
---

#title
Construtor

#description
O construtor Node não deve ser usado diretamente

#content
Nodes são criados automaticamente pelo `Manager` quando você o inicializa com as opções de node.

```js
// Não use diretamente
// new Node(options, manager);

// Em vez disso, configure os nodes através do Manager
const manager = new Manager({
  nodes: [
    {
      identifier: 'Node 1',
      host: 'localhost',
      port: 2333,
      password: 'youshallnotpass',
      secure: false
    }
  ],
  // ... outras opções
});
```

#footer
Sempre configure os nodes através do Manager
::

## Propriedades

| Propriedade | Tipo | Descrição | Padrão |
|----------|------|-------------|---------|
| `uuid` | `String` | Identificador único para a instância do node | Gerado |
| `host` | `String` | O hostname do servidor Lavalink | Obrigatório |
| `port` | `Number` | A porta do servidor Lavalink | Obrigatório |
| `identifier` | `String` | Um identificador único para o node. Se não fornecido, um UUID será gerado. | Gerado |
| `password` | `String` | A senha para o servidor Lavalink. | `"youshallnotpass"` |
| `pathVersion` | `String` | Caminho da versão da API para o Lavalink | `"v4"` |
| `connected` | `Boolean` | Se o node está conectado | `false` |
| `destroyed` | `Boolean` | Se o node foi destruído | `false` |
| `reconnectTimeout` | `NodeJS.Timeout` | Tempo limite de reconexão atual | `undefined` |
| `reconnectAttempts` | `Number` | Número de tentativas de reconexão feitas | `0` |
| `retryAmount` | `Number` | Número máximo de tentativas de reconexão | `5` |
| `retryDelay` | `Number` | Atraso entre as tentativas de reconexão (ms) | `60000` |
| `resumed` | `Boolean` | Se a sessão do node foi retomada | `false` |
| `resumeTimeout` | `Number` | Tempo limite de retomada da sessão (ms) | `60000` |
| `regions` | `Array<String>` | Regiões de voz associadas a este node | `[]` |
| `secure` | `Boolean` | Se deve usar conexão SSL/TLS | `false` |
| `sessionId` | `String` | O ID da sessão atual | Gerado |
| `priority` | `Number` | A prioridade do node para seleção | `undefined` |
| `socket` | `WebSocket` | A conexão WebSocket com o Lavalink | Criado |
| `stats` | `INodeStats` | Estatísticas do node (CPU, memória, players) | `undefined` |
| `info` | `Object` | Informações adicionais do node | `undefined` |
| `version` | `String` | Versão do servidor Lavalink | `undefined` |
| `url` | `String` | URL base para requisições REST | Gerado |
| `rest` | `REST` | A instância REST para fazer requisições HTTP | Criado |
| `state` | `NodeState` | O estado atual do node | `DISCONNECTED` |
| `capabilities` | `Array<String>` | Capacidades suportadas pelo node (ex: `lavadspx`, `lavasearch`) | `[]` |
| `plugins` | `Map<String, AbstractPlugin>` | Mapa de plugins carregados para este node | `Map` |

## Métodos

#### connect
::field{name="connect" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:link'
  ---
  #title
  Conectar ao Node

  #description
  Estabelece conexão com o servidor Lavalink com retomada de sessão opcional. Define o estado do node como `CONNECTING`.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`void`**

  ```js
  node.connect();
  ```
  ::
::
::

#### reconnect
::field{name="reconnect" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:refresh-cw'
  ---
  #title
  Reconectar Node

  #description
  Tenta reconectar ao servidor Lavalink após um atraso com backoff exponencial. Define o estado do node como `CONNECTING`. Se as tentativas de reconexão se esgotarem, ele tenta migrar os players para outro node.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`void`**

  ```js
  node.reconnect();
  ```
  ::
::
::

#### destroy
::field{name="destroy" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:trash'
  ---
  #title
  Destruir Node

  #description
  Fecha a conexão WebSocket e marca o node como destruído. Descarrega quaisquer plugins carregados para este node.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`void`**

  ```js
  node.destroy();
  ```
  ::
::
::

#### getPlayers
::field{name="getPlayers" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:users'
  ---
  #title
  Obter Players

  #description
  Obtém todos os players conectados a este node.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`Player[]`** — Array de players conectados a este node

  ```js
  const players = node.getPlayers();
  console.log(`Players no node: ${players.length}`);
  ```
  ::
::
::

#### getPlayersCount
::field{name="getPlayersCount" type="property"}
::stack
  ::card
  ---
  icon: 'lucide:users'
  ---
  #title
  Obter Contagem de Players

  #description
  Obtém o número de players conectados a este node.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`number`** — Número de players conectados

  ```js
  const count = node.getPlayersCount;
  console.log(`Players conectados: ${count}`);
  ```
  ::
::
::

#### getSystemStats
::field{name="getSystemStats" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:activity'
  ---
  #title
  Obter Estatísticas do Sistema

  #description
  Recupera estatísticas de uso de CPU e memória para o node.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`{ cpuLoad: number; memoryUsage: number }`** — Objeto contendo carga da CPU e uso de memória

  ```js
  const stats = node.getSystemStats();
  console.log(`Carga da CPU: ${stats.cpuLoad}%, Uso de Memória: ${stats.memoryUsage} bytes`);
  ```
  ::
::
::

#### isOverloaded
::field{name="isOverloaded" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:alert-triangle'
  ---
  #title
  Está Sobrecarregado

  #description
  Verifica se o node está atualmente sobrecarregado com base nos limites de CPU e memória.
  <br>
  <h5>Parâmetros</h5>

  ::field-group
    ::field{name="cpuThreshold" type="number" defaultValue="80"}
    Limite percentual de uso da CPU
    ::

    ::field{name="memoryThreshold" type="number" defaultValue="80"}
    Limite percentual de uso da memória
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`boolean`** — Verdadeiro se o node estiver sobrecarregado, falso caso contrário

  ```js
  if (node.isOverloaded()) {
    console.log('Node está sobrecarregado!');
  }
  ```
  ::
::
::

#### migrateAllPlayers
::field{name="migrateAllPlayers" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:git-branch'
  ---
  #title
  Migrar Todos os Players

  #description
  Migra todos os players deste node para outro node especificado ou para o melhor node disponível.
  <br>
  <h5>Parâmetros</h5>

  ::field-group
    ::field{name="targetNode" type="Node"}
    O node de destino para o qual migrar os players. Se não fornecido, o melhor node disponível será escolhido.
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`Promise<void>`**

  ```js
  await node.migrateAllPlayers();
  ```
  ::
::
::

#### getNodeStatus
::field{name="getNodeStatus" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:info'
  ---
  #title
  Obter Status do Node

  #description
  Recupera um relatório de status abrangente para o node, incluindo informações de conexão, desempenho e players.
  <br>
  <h5>Parâmetros</h5>

  ::field-group
    ::field{name="timeout" type="number" defaultValue="2000"}
    Tempo limite em milissegundos para a verificação de saúde.
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`object`** — Um objeto contendo o status do node, incluindo `connected`, `version`, `stats` (cpu, memory, uptime), `players` (total, active, paused, idle), e `health` (status, needsRestart, responding, performance).

  ```js
  const status = await node.getNodeStatus();
  console.log(status);
  /*
  Exemplo de Saída:
  {
    identifier: 'Node-1',
    connected: true,
    version: '1.4.0',
    stats: {
      cpu: 0.5,
      memory: 1024000000,
      uptime: 123456789
    },
    players: {
      total: 5,
      active: 3,
      paused: 2,
      idle: 0
    },
    health: {
      status: 'stable',
      needsRestart: false,
      responding: true,
      performance: 'excellent'
    }
  }
  */
  ```
  ::
::
::


## Considerações de Desempenho

::alert{type="warning" icon="lucide:cpu"}
Considere estas dicas para um desempenho ideal do node:
::

1. **Balanceamento de Carga**: Distribua os players entre vários nodes para um melhor desempenho.
2. **Monitoramento**: Monitore regularmente as estatísticas do node para identificar problemas de desempenho.
3. **Reconexão**: Configure corretamente os parâmetros de reconexão para lidar com desconexões temporárias.
4. **Regiões**: Associe nodes a regiões específicas para otimizar a latência de voz.

::button-link{right-icon="lucide:arrow-right" to="/api/queue"}
  Continuar para a Fila
:: 