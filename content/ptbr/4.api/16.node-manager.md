---
title: NodeManager
description: "Referência da API para a classe NodeManager em Moonlink.js"
icon: 'lucide:server-cog'
authors:
  - avatar: https://www.npmjs.com/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9hNmE5NDVhYjJiNzk1MjcyNzVjN2IwMWEyNWM1YzQ2NT9zaXplPTQ5NiZkZWZhdWx0PXJldHJvIn0.5hP6oyShhR-UWUi6KF-lA0cWmE_BJjvIFAwkYCGEZNo
    name: Lucas Morais Rodrigues
    username: 1Lucas1apk
    to: https://github.com/1Lucas1apk
    target: _blank
---

<branch version="1.0.x">

::card{icon="lucide:server-cog"}
#title
Classe NodeManager

#description
A classe NodeManager é responsável por gerenciar nodes Lavalink no Moonlink.js. Ela fornece métodos para adicionar, remover e recuperar nodes, bem como selecionar o melhor node com base em vários critérios.
<br>
```js
manager.nodes
```
::

::alert{type="info" icon="lucide:info"}
O NodeManager é acessado através da propriedade `nodes` da instância do Manager. Você não precisa criá-lo manualmente.
::

## Visão Geral

::card{icon="lucide:box"}
#title
Propriedades

#description
Propriedades principais da classe NodeManager.
<br>
<h5>Propriedades Disponíveis</h5>

#content
| Propriedade | Tipo | Descrição |
|----------|------|-------------|
| `manager` | `Manager` | Referência à instância do Manager |
| `cache` | `Map<string \| number, Node>` | Mapa contendo todos os nodes com seus identificadores como chaves |
::

## Configuração do Node

::card{icon="lucide:settings"}
#title
Opções de Configuração do Node

#description
Opções para configurar nodes Lavalink.
<br>
<h5>Opções Disponíveis</h5>

#content
| Opção | Tipo | Obrigatório | Padrão | Descrição |
|--------|------|----------|---------|-------------|
| `host` | `string` | Sim | - | Nome do host ou endereço IP do servidor Lavalink |
| `port` | `number` | Sim | - | Número da porta do servidor Lavalink (0-65535) |
| `password` | `string` | Não | "youshallnotpass" | Senha para o servidor Lavalink |
| `secure` | `boolean` | Não | `false` | Se deve usar SSL/TLS para a conexão |
| `identifier` | `string` | Não | UUID Gerado | Identificador único para o node |
| `id` | `number` | Não | - | Um identificador numérico opcional para o node. Principalmente para rastreamento interno, não usado para recuperação de node. |
| `retryAmount` | `number` | Não | 5 | Número de tentativas de reconexão |
| `retryDelay` | `number` | Não | 30000 | Atraso entre as tentativas de reconexão (ms) |
| `regions` | `string[]` | Não | `[]` | Regiões de voz para as quais este node é ideal |
| `pathVersion` | `string` | Não | "v4" | Versão da API REST do Lavalink |
| `sessionId` | `string` | Não | Gerado | ID da sessão para retomar conexões |
::

## Métodos

::card{icon="lucide:code"}
#title
Métodos

#description
Métodos disponíveis na classe NodeManager.
<br>
<h5>Métodos Disponíveis</h5>

#content
#### check
::field{name="check" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:check'
  ---
  #title
  Verificar Configuração do Node

  #description
  Valida um objeto de configuração de node antes de adicioná-lo ao cache.
  <br>
  <h5>Parâmetros</h5>

  ::field-group
    ::field{name="node" type="INode" required}
    O objeto de configuração do node a ser validado
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`void`** — Lança um erro se a configuração for inválida

```js
// Validar configuração do node
manager.nodes.check({
  host: 'localhost',
  port: 2333,
  password: 'youshallnotpass'
});
```
  ::
::
::

#### init
::field{name="init" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:power'
  ---
  #title
  Inicializar Nodes

  #description
  Inicializa todos os nodes no cache conectando-os aos seus respectivos servidores Lavalink.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`void`**

```js
// Inicializar todos os nodes
manager.nodes.init();
```
  ::
::
::

#### add
::field{name="add" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:plus'
  ---
  #title
  Adicionar Node

  #description
  Adiciona um novo node ao cache e o inicializa.
  <br>
  <h5>Parâmetros</h5>

  ::field-group
    ::field{name="node" type="INode" required}
    O objeto de configuração do node a ser adicionado
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`void`**

```js
// Adicionar um novo node
manager.nodes.add({
  identifier: 'US-Node',
  host: 'us.lavalink.com',
  port: 2333,
  password: 'password',
  secure: true,
  regions: ['us', 'us-east']
});
```
  ::
::
::

#### remove
::field{name="remove" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:trash'
  ---
  #title
  Remover Node

  #description
  Remove um node do cache e destrói sua conexão.
  <br>
  <h5>Parâmetros</h5>

  ::field-group
    ::field{name="identifier" type="string" required}
    O identificador do node a ser removido
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`void`**

```js
// Remover um node
manager.nodes.remove('US-Node');
```
  ::
::
::

#### get
::field{name="get" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:search'
  ---
  #title
  Obter Node

  #description
  Obtém um node do cache pelo seu identificador.
  <br>
  <h5>Parâmetros</h5>

  ::field-group
    ::field{name="identifier" type="string | number" required}
    O identificador do node a ser obtido
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`Node`** — A instância do node (lança erro se não encontrado)

```js
// Obter um node específico
const node = manager.nodes.get('US-Node');

// Obter node padrão (se apenas um existir)
const defaultNode = manager.nodes.get('default');
```
  ::
::
::

#### best
::field{name="best" type="property"}
::stack
  ::card
  ---
  icon: 'lucide:star'
  ---
  #title
  Obter Melhor Node

  #description
  Obtém o node com o menor número de players de todos os nodes conectados.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`Node`** — O node com o menor número de players

```js
// Obter o melhor node disponível
const bestNode = manager.nodes.best;
```
  ::
::
::

#### sortByUsage
::field{name="sortByUsage" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:sort'
  ---
  #title
  Ordenar por Uso

  #description
  Obtém um node com base nos critérios de ordenação especificados. Considera apenas nodes conectados.
  <br>
  <h5>Parâmetros</h5>

  ::field-group
    ::field{name="sortType" type="TSortTypeNode" required}
    Os critérios para ordenar os nodes
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Retornos e Exemplo

  #description
  **Retornos**
  • **`Node`** — O node que melhor corresponde aos critérios de ordenação

  **Tipos de Ordenação**
  | Tipo | Descrição |
  |------|-------------|
  | `"players"` | Ordenar pelo número total de players |
  | `"playingPlayers"` | Ordenar pelo número de players ativos |
  | `"memory"` | Ordenar pelo uso de memória |
  | `"cpuLavalink"` | Ordenar pelo uso da CPU do processo Lavalink |
  | `"cpuSystem"` | Ordenar pelo uso da CPU do sistema |
  | `"uptime"` | Ordenar pelo tempo de atividade do node |
  | `"random"` | Selecionar um node aleatório |

```js
// Obter node com menor uso de memória
const memoryNode = manager.nodes.sortByUsage('memory');

// Obter node com menor uso de CPU
const cpuNode = manager.nodes.sortByUsage('cpuLavalink');

// Obter node aleatório
const randomNode = manager.nodes.sortByUsage('random');
```
  ::
::
::

## Exemplos de Uso

::card{icon="lucide:code"}
#title
Exemplos Básicos

#description
Exemplos simples de uso do NodeManager.

#content
### Configuração Básica do Node

```js
const { Client } = require('discord.js');
const { Manager } = require('moonlink.js');

const client = new Client();

// Crie o Manager com nodes
const manager = new Manager({
  nodes: [
    {
      identifier: 'Main',
      host: 'localhost',
      port: 2333,
      password: 'youshallnotpass'
    },
    {
      identifier: 'Backup',
      host: 'backup.lavalink.com',
      port: 2333,
      password: 'secure',
      secure: true
    }
  ],
  sendPayload: (guildId, payload) => {
    const guild = client.guilds.cache.get(guildId);
    if (guild) guild.shard.send(payload);
  }
});

// Inicialize os nodes quando o cliente estiver pronto
client.once('ready', () => {
  manager.init(client.user.id);
});

// Lide com eventos do node
manager.on('nodeConnect', (node) => {
  console.log(`Node ${node.identifier} conectado`);
});

manager.on('nodeError', (node, error) => {
  console.error(`Node ${node.identifier} encontrou um erro:`, error);
});

manager.on('nodeDisconnect', (node) => {
  console.log(`Node ${node.identifier} desconectado`);
});

manager.on('debug', (message) => {
  console.log('Debug:', message);
});
```

### Configuração de Node Regional

```js
const manager = new Manager({
  nodes: [
    {
      identifier: 'US-Node',
      host: 'us.lavalink.com',
      port: 2333,
      password: 'password',
      regions: ['us', 'us-east', 'us-west']
    },
    {
      identifier: 'EU-Node',
      host: 'eu.lavalink.com',
      port: 2333,
      password: 'password',
      regions: ['eu', 'eu-west', 'eu-central']
    }
  ],
  options: {
    sortPlayersByRegion: true
  }
});
```

### Gerenciamento de Node

```js
// Adicionar um novo node dinamicamente
manager.nodes.add({
  identifier: 'Dynamic-Node',
  host: 'dynamic.lavalink.com',
  port: 2333,
  password: 'password'
});

// Remover um node
manager.nodes.remove('Dynamic-Node');

// Obter o melhor node para um caso de uso específico
const memoryNode = manager.nodes.sortByUsage('memory');
const cpuNode = manager.nodes.sortByUsage('cpuLavalink');
const randomNode = manager.nodes.sortByUsage('random');
```
::

## Eventos do Node

::card{icon="lucide:bell"}
#title
Eventos

#description
Eventos emitidos pelo NodeManager através da instância do Manager.
<br>
<h5>Eventos Disponíveis</h5>

#content
| Evento | Parâmetros | Descrição |
|-------|------------|-------------|
| `nodeConnect` | `(node: Node)` | Emitido quando um node se conecta |
| `nodeDisconnect` | `(node: Node)` | Emitido quando um node se desconecta |
| `nodeError` | `(node: Node, error: Error)` | Emitido quando um node encontra um erro |
| `nodeReconnect` | `(node: Node)` | Emitido quando um node tenta reconectar |
| `nodeCreate` | `(node: Node)` | Emitido quando um novo node é criado |
| `nodeDestroy` | `(identifier: string)` | Emitido quando um node é destruído |
| `debug` | `(message: string)` | Emitido para informações de depuração |

**Exemplo**
```js
// Lidar com eventos do node
manager.on('nodeConnect', (node) => {
  console.log(`Node ${node.identifier} conectado`);
});

manager.on('nodeError', (node, error) => {
  console.error(`Node ${node.identifier} erro:`, error);
});

manager.on('nodeDisconnect', (node) => {
  console.log(`Node ${node.identifier} desconectado`);
});

manager.on('debug', (message) => {
  console.log('Debug:', message);
});
```
::

::button-link{right-icon="lucide:arrow-right" to="/api/player"}
  Continuar para Player
:: 