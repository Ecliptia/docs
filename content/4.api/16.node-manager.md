---
title: NodeManager
description: "API reference for the NodeManager class in Moonlink.js"
icon: 'lucide:server-cog'
authors:
  - avatar: https://www.npmjs.com/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9hNmE5NDVhYjJiNzk1MjcyNzVjN2IwMWEyNWM1YzQ2NT9zaXplPTQ5NiZkZWZhdWx0PXJldHJvIn0.5hP6oyShhR-UWUi6KF-lA0cWmE_BJjvIFAwkYCGEZNo
    name: Lucas Morais Rodrigues
    username: 1Lucas1apk
    to: https://github.com/1Lucas1apk
    target: _blank
---

<branch version="1.0.x">

::card{icon="lucide:server-cog"}
#title
NodeManager Class

#description
The NodeManager class is responsible for managing Lavalink nodes in Moonlink.js. It provides methods for adding, removing, and retrieving nodes, as well as selecting the best node based on various criteria.
<br>
```js
manager.nodes
```
::

::alert{type="info" icon="lucide:info"}
The NodeManager is accessed through the `nodes` property of the Manager instance. You don't need to create it manually.
::

## Overview

::card{icon="lucide:box"}
#title
Properties

#description
Core properties of the NodeManager class.
<br>
<h5>Available Properties</h5>

#content
| Property | Type | Description |
|----------|------|-------------|
| `manager` | `Manager` | Reference to the Manager instance |
| `cache` | `Map<string \| number, Node>` | Map containing all nodes with their identifiers as keys |
::

## Node Configuration

::card{icon="lucide:settings"}
#title
Node Configuration Options

#description
Options for configuring Lavalink nodes.
<br>
<h5>Available Options</h5>

#content
| Option | Type | Required | Default | Description |
|--------|------|----------|---------|-------------|
| `host` | `string` | Yes | - | Hostname or IP address of the Lavalink server |
| `port` | `number` | Yes | - | Port number of the Lavalink server (0-65535) |
| `password` | `string` | No | "youshallnotpass" | Password for the Lavalink server |
| `secure` | `boolean` | No | `false` | Whether to use SSL/TLS for the connection |
| `identifier` | `string` | No | Generated UUID | Unique identifier for the node |
| `id` | `number` | No | - | An optional numeric identifier for the node. Primarily for internal tracking, not used for node retrieval. |
| `retryAmount` | `number` | No | 5 | Number of reconnection attempts |
| `retryDelay` | `number` | No | 30000 | Delay between reconnection attempts (ms) |
| `regions` | `string[]` | No | `[]` | Voice regions this node is optimal for |
| `pathVersion` | `string` | No | "v4" | Lavalink REST API version |
| `sessionId` | `string` | No | Generated | Session ID for resuming connections |
::

## Methods

::card{icon="lucide:code"}
#title
Methods

#description
Available methods in the NodeManager class.
<br>
<h5>Available Methods</h5>

#content
#### check
::field{name="check" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:check'
  ---
  #title
  Check Node Configuration

  #description
  Validates a node configuration object before adding it to the cache.
  <br>
  <h5>Parameters</h5>

  ::field-group
    ::field{name="node" type="INode" required}
    The node configuration object to validate
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Returns & Example

  #description
  **Returns**
  • **`void`** — Throws an error if the configuration is invalid

```js
// Validate node configuration
manager.nodes.check({
  host: 'localhost',
  port: 2333,
  password: 'youshallnotpass'
});
```
  ::
::
::

#### init
::field{name="init" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:power'
  ---
  #title
  Initialize Nodes

  #description
  Initializes all nodes in the cache by connecting them to their respective Lavalink servers.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Returns & Example

  #description
  **Returns**
  • **`void`**

```js
// Initialize all nodes
manager.nodes.init();
```
  ::
::
::

#### add
::field{name="add" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:plus'
  ---
  #title
  Add Node

  #description
  Adds a new node to the cache and initializes it.
  <br>
  <h5>Parameters</h5>

  ::field-group
    ::field{name="node" type="INode" required}
    The node configuration object to add
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Returns & Example

  #description
  **Returns**
  • **`void`**

```js
// Add a new node
manager.nodes.add({
  identifier: 'US-Node',
  host: 'us.lavalink.com',
  port: 2333,
  password: 'password',
  secure: true,
  regions: ['us', 'us-east']
});
```
  ::
::
::

#### remove
::field{name="remove" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:trash'
  ---
  #title
  Remove Node

  #description
  Removes a node from the cache and destroys its connection.
  <br>
  <h5>Parameters</h5>

  ::field-group
    ::field{name="identifier" type="string" required}
    The identifier of the node to remove
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Returns & Example

  #description
  **Returns**
  • **`void`**

```js
// Remove a node
manager.nodes.remove('US-Node');
```
  ::
::
::

#### get
::field{name="get" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:search'
  ---
  #title
  Get Node

  #description
  Gets a node from the cache by its identifier.
  <br>
  <h5>Parameters</h5>

  ::field-group
    ::field{name="identifier" type="string | number" required}
    The identifier of the node to get
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Returns & Example

  #description
  **Returns**
  • **`Node`** — The node instance (throws error if not found)

```js
// Get a specific node
const node = manager.nodes.get('US-Node');

// Get default node (if only one exists)
const defaultNode = manager.nodes.get('default');
```
  ::
::
::

#### best
::field{name="best" type="property"}
::stack
  ::card
  ---
  icon: 'lucide:star'
  ---
  #title
  Get Best Node

  #description
  Gets the node with the least number of players from all connected nodes.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Returns & Example

  #description
  **Returns**
  • **`Node`** — The node with the least number of players

```js
// Get the best available node
const bestNode = manager.nodes.best;
```
  ::
::
::

#### sortByUsage
::field{name="sortByUsage" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:sort'
  ---
  #title
  Sort By Usage

  #description
  Gets a node based on the specified sorting criteria. Only considers connected nodes.
  <br>
  <h5>Parameters</h5>

  ::field-group
    ::field{name="sortType" type="TSortTypeNode" required}
    The criteria to sort nodes by
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Returns & Example

  #description
  **Returns**
  • **`Node`** — The node that best matches the sorting criteria

  **Sorting Types**
  | Type | Description |
  |------|-------------|
  | `"players"` | Sort by total number of players |
  | `"playingPlayers"` | Sort by number of actively playing players |
  | `"memory"` | Sort by memory usage |
  | `"cpuLavalink"` | Sort by Lavalink process CPU usage |
  | `"cpuSystem"` | Sort by system CPU usage |
  | `"uptime"` | Sort by node uptime |
  | `"random"` | Select a random node |

```js
// Get node with least memory usage
const memoryNode = manager.nodes.sortByUsage('memory');

// Get node with least CPU usage
const cpuNode = manager.nodes.sortByUsage('cpuLavalink');

// Get random node
const randomNode = manager.nodes.sortByUsage('random');
```
  ::
::
::
::

## Usage Examples

::card{icon="lucide:code"}
#title
Basic Examples

#description
Simple examples of using the NodeManager.

#content
### Basic Node Setup

```js
const { Client } = require('discord.js');
const { Manager } = require('moonlink.js');

const client = new Client();

// Create Manager with nodes
const manager = new Manager({
  nodes: [
    {
      identifier: 'Main',
      host: 'localhost',
      port: 2333,
      password: 'youshallnotpass'
    },
    {
      identifier: 'Backup',
      host: 'backup.lavalink.com',
      port: 2333,
      password: 'secure',
      secure: true
    }
  ],
  sendPayload: (guildId, payload) => {
    const guild = client.guilds.cache.get(guildId);
    if (guild) guild.shard.send(payload);
  }
});

// Initialize nodes when client is ready
client.once('ready', () => {
  manager.init(client.user.id);
});

// Handle node events
manager.on('nodeConnect', (node) => {
  console.log(`Node ${node.identifier} connected`);
});

manager.on('nodeError', (node, error) => {
  console.error(`Node ${node.identifier} encountered an error:`, error);
});
```

### Regional Node Setup

```js
const manager = new Manager({
  nodes: [
    {
      identifier: 'US-Node',
      host: 'us.lavalink.com',
      port: 2333,
      password: 'password',
      regions: ['us', 'us-east', 'us-west']
    },
    {
      identifier: 'EU-Node',
      host: 'eu.lavalink.com',
      port: 2333,
      password: 'password',
      regions: ['eu', 'eu-west', 'eu-central']
    }
  ],
  options: {
    sortPlayersByRegion: true
  }
});
```

### Node Management

```js
// Add a new node dynamically
manager.nodes.add({
  identifier: 'Dynamic-Node',
  host: 'dynamic.lavalink.com',
  port: 2333,
  password: 'password'
});

// Remove a node
manager.nodes.remove('Dynamic-Node');

// Get the best node for a specific use case
const memoryNode = manager.nodes.sortByUsage('memory');
const cpuNode = manager.nodes.sortByUsage('cpuLavalink');
const randomNode = manager.nodes.sortByUsage('random');
```
::

## Node Events

::card{icon="lucide:bell"}
#title
Events

#description
Events emitted by the NodeManager through the Manager instance.
<br>
<h5>Available Events</h5>

#content
| Event | Parameters | Description |
|-------|------------|-------------|
| `nodeConnect` | `(node: Node)` | Emitted when a node connects |
| `nodeDisconnect` | `(node: Node)` | Emitted when a node disconnects |
| `nodeError` | `(node: Node, error: Error)` | Emitted when a node encounters an error |
| `nodeReconnect` | `(node: Node)` | Emitted when a node attempts to reconnect |
| `nodeCreate` | `(node: Node)` | Emitted when a new node is created |
| `nodeDestroy` | `(identifier: string)` | Emitted when a node is destroyed |
| `debug` | `(message: string)` | Emitted for debugging information |

**Example**
```js
// Handle node events
manager.on('nodeConnect', (node) => {
  console.log(`Node ${node.identifier} connected`);
});

manager.on('nodeError', (node, error) => {
  console.error(`Node ${node.identifier} error:`, error);
});

manager.on('nodeDisconnect', (node) => {
  console.log(`Node ${node.identifier} disconnected`);
});

manager.on('debug', (message) => {
  console.log('Debug:', message);
});
```
::

::button-link{right-icon="lucide:arrow-right" to="/api/player"}
  Continue to Player
:: 