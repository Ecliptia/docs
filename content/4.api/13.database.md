---
title: Database
description: "API reference for the Database class in Moonlink.js"
icon: 'lucide:database'
authors:
  - avatar: https://www.npmjs.com/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9hNmE5NDVhYjJiNzk1MjcyNzVjN2IwMWEyNWM1YzQ2NT9zaXplPTQ5NiZkZWZhdWx0PXJldHJvIn0.5hP6oyShhR-UWUi6KF-lA0cWmE_BJjvIFAwkYCGEZNo
    name: Lucas Morais Rodrigues
    username: 1Lucas1apk
    to: https://github.com/1Lucas1apk
    target: _blank
---

<branch version="1.0.x">

::card{icon="lucide:database"}
#title
Database Class

#description
The Database class provides a robust key-value storage system for Moonlink.js, used internally to store player, node, and queue data. It utilizes a Write-Ahead Log (WAL) for data persistence and recovery.
<br>

::alert{type="info" icon="lucide:info"}
The Database class is automatically initialized by the Manager and can be accessed through `manager.database`. It is instantiated using the static `Database.create()` method.
::

## Overview

::card{icon="lucide:box"}
#title
Initialization

#description
The Database is initialized asynchronously and should be accessed via the static `create` method.
<br>

```typescript
class Database {
  static async create(manager: Manager): Promise<Database>;
}
```

#content
**Example**
```js
const manager = new Manager({ /* ... */ });
// Database is automatically created during manager.init()
await manager.init(client.user.id);
const database = manager.database;
```
::

## Methods

::card{icon="lucide:settings"}
#title
Methods

#description
Methods available in the Database class.
<br>
<h5>Available Methods</h5>

#content
#### set
::field{name="set" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:edit'
  ---
  #title
  Set Value

  #description
  Stores a value associated with a key. If the key points to an object and the new value is also an object, they will be merged. Supports optional logging to WAL.
  <br>
  <h5>Parameters</h5>

  ::field-group
    ::field{name="key" type="string" required}
    The key (path) to store the value (e.g., `settings.volume`, `players.guildId.volume`)
    ::
    ::field{name="value" type="T" required}
    The value to store
    ::
    ::field{name="log" type="boolean"}
    Optional: Whether to log this operation to the Write-Ahead Log. Defaults to `true`.
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Returns & Example

  #description
  **Returns**
  • **`void`**

```js
database.set('settings.volume', 100);
database.set('queue.guildId', tracks, false); // Don't log to WAL
```
  ::
::
::

#### get
::field{name="get" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:search'
  ---
  #title
  Get Value

  #description
  Retrieves a value by its key.
  <br>
  <h5>Parameters</h5>

  ::field-group
    ::field{name="key" type="string" required}
    The key (path) to retrieve
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Returns & Example

  #description
  **Returns**
  • **`T | undefined`** - The stored value or undefined if not found

```js
const volume = database.get('settings.volume');
const queue = database.get('queue.guildId');
```
  ::
::
::

#### delete
::field{name="delete" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:trash'
  ---
  #title
  Delete Value

  #description
  Removes a value by its key. Supports optional logging to WAL.
  <br>
  <h5>Parameters</h5>

  ::field-group
    ::field{name="key" type="string" required}
    The key (path) to delete
    ::
    ::field{name="log" type="boolean"}
    Optional: Whether to log this operation to the Write-Ahead Log. Defaults to `true`.
    ::
  ::
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Returns & Example

  #description
  **Returns**
  • **`boolean`** - True if the key was deleted, false otherwise

```js
const deleted = database.delete('settings.volume');
database.delete('queue.guildId', false); // Don't log to WAL
```
  ::
::
::

#### keys
::field{name="keys" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:key'
  ---
  #title
  Get All Keys

  #description
  Retrieves all top-level and nested keys stored in the database.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Returns & Example

  #description
  **Returns**
  • **`string[]`** - An array of all keys.

  ```js
  const allKeys = database.keys();
  console.log(allKeys);
  // Example: ['players.guildId.volume', 'nodes.nodeId.sessionId']
  ```
  ::
::
::

#### clear
::field{name="clear" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:eraser'
  ---
  #title
  Clear All Data

  #description
  Clears all data from the database, effectively resetting it. Also clears the Write-Ahead Log.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Returns & Example

  #description
  **Returns**
  • **`void`**

  ```js
  database.clear();
  console.log('Database cleared.');
  ```
  ::
::
::

#### shutdown
::field{name="shutdown" type="method"}
::stack
  ::card
  ---
  icon: 'lucide:power-off'
  ---
  #title
  Shutdown Database

  #description
  Gracefully shuts down the database, ensuring all pending writes are flushed and resources are released.
  This should be called before your application exits.
  <br>
  ::

  ::card
  ---
  icon: 'lucide:fold-horizontal'
  icon-size: 26
  horizontal: true
  ---
  #title
  Returns & Example

  #description
  **Returns**
  • **`Promise<void>`**

  ```js
  await database.shutdown();
  console.log('Database shut down.');
  ```
  ::
::
::

## File Storage

::card{icon="lucide:hard-drive"}
#title
Write-Ahead Log (WAL) Persistence

#description
The Database class implements a Write-Ahead Log (WAL) system for robust data persistence and recovery.

#content
Data changes are first written to a sequential log file (WAL) and then periodically compacted into a snapshot file. This ensures data integrity and allows for recovery in case of unexpected shutdowns.

- **Log Files**: Changes are appended to `data.{clientId}.wal`.
- **Snapshot Files**: Periodically, the in-memory state is saved to `data.{clientId}.json`.
- **Automatic Recovery**: On initialization, the database replays the WAL to restore the latest state.

**File Structure**
```
moonlink.js/
  └── src/
      └── datastore/
          ├── data.123456789.json  // Snapshot of the database
          └── data.123456789.wal   // Write-Ahead Log
```

::alert{type="warning" icon="lucide:alert-triangle"}
The file storage system is handled automatically. You should not need to interact with these files directly. Manual modification can lead to data corruption.
::
::

## Usage Examples

::card{icon="lucide:code"}
#title
Basic Usage

#description
Examples of using the Database class.

#content
```js
// Access the database through the manager
const database = manager.database;

// Store player data
database.set(`players.${guildId}`, {
  volume: 100,
  paused: false,
  position: 0
});

// Retrieve player data
const playerData = database.get(`players.${guildId}`);

// Remove player data
database.delete(`players.${guildId}`);

// Get all keys
const allKeys = database.keys();

// Clear all data
database.clear();

// Shutdown the database (call before application exits)
await database.shutdown();
```
::

::button-link{right-icon="lucide:arrow-right" to="/api/listen"}
  Continue to Listen
:: 